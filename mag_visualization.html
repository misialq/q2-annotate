<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Metagenome Contig Binning Visualization</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="mag_visualization.css">
</head>
<body>
  <div class="controls">
    <div class="control-group"><label for="sample-select">Sample</label><select id="sample-select"></select></div>
    <div class="control-group"><label for="sort-select">Sort by</label><select id="sort-select"><option value="id">ID</option><option value="contamination">Contamination</option><option value="completeness" selected>Completeness</option></select></div>
    <div class="control-group"><label for="order-select">Order</label><select id="order-select"><option value="descending" selected>Descending</option><option value="ascending">Ascending</option></select></div>
    <div class="control-group"><label for="scaling-select">Scale bars by</label><select id="scaling-select"><option value="length" selected>Assembly Length</option><option value="count">Contig Count</option></select></div>
    <div class="control-group"><label for="classification-level-select">Min Classification</label><select id="classification-level-select"><option value="none" selected>Any Level</option><option value="1">Level 1 (Domain)</option><option value="2">Level 2 (Kingdom)</option><option value="3">Level 3 (Phylum)</option><option value="4">Level 4 (Class)</option><option value="5">Level 5 (Order)</option><option value="6">Level 6 (Family)</option><option value="7">Level 7 (Genus)</option><option value="8">Level 8 (Species)</option></select></div>
    <div class="control-group">
        <label for="cont-threshold">Max Contamination</label>
        <div class="control-with-value">
            <input id="cont-threshold" type="range" min="0" max="100" value="100"/>
            <span class="control-value-display" id="cont-threshold-value-display">100%</span>
  </div>
    </div>
    <div class="control-group">
        <label for="comp-threshold">Max Completeness</label>
        <div class="control-with-value">
            <input id="comp-threshold" type="range" min="0" max="100" value="100"/>
            <span class="control-value-display" id="comp-threshold-value-display">100%</span>
        </div>
    </div>
    <div class="control-group">
        <label for="collapse-level-select">Collapse by</label>
        <select id="collapse-level-select">
            <option value="none" selected>No Collapse</option>
            <option value="1">Level 1 (Domain)</option>
            <option value="2">Level 2 (Kingdom)</option>
            <option value="3">Level 3 (Phylum)</option>
            <option value="4">Level 4 (Class)</option>
            <option value="5">Level 5 (Order)</option>
            <option value="6">Level 6 (Family)</option>
            <option value="7">Level 7 (Genus)</option>
            <option value="8">Level 8 (Species)</option>
        </select>
    </div>
    <div class="control-group">
        <label>Details View</label>
        <div class="modal-toggle-container" id="details-view-toggle-container">
            <span class="toggle-label view-option active" data-view="circular">Circular</span>
            <span class="toggle-label view-option" data-view="bar">Bar</span>
            <span class="toggle-label view-option" data-view="gc">GC</span>
        </div>
    </div>
    <div class="control-group legend-box control-group-wide">
        <label>Quality Filter</label>
        <div class="legend-items-container">
            <div class="legend-item" data-quality="High"><i class="bi bi-check-circle-fill quality-high"></i><span>High</span></div>
            <div class="legend-item" data-quality="Medium"><i class="bi bi-circle-half quality-medium"></i><span>Medium</span></div>
            <div class="legend-item" data-quality="Low"><i class="bi bi-exclamation-triangle-fill quality-low"></i><span>Low</span></div>
        </div>
    </div>
    <div class="control-group action-button-container">
        <button id="taxonomy-distribution-btn" class="action-button">
            <i class="bi bi-bar-chart-fill"></i>
            <span>Taxonomy</span>
        </button>
    </div>
  </div>

  <div class="main-content-area">
    <div id="main-chart-column-wrapper">
  <div class="chart-container">
    <svg class="chart"></svg>
    <div class="warning" id="warning">No MAGs were recovered in this sample.</div>
    <span class="info-icon" id="main-chart-info-icon"><i class="bi bi-info-circle"></i></span>
            <div class="left-plot-legend">
                <div class="legend-item-small">
                    <div class="legend-color-box legend-contamination"></div>
                    <span>Contamination</span>
  </div>
                <div class="legend-item-small">
                    <div class="legend-color-box legend-completeness"></div>
                    <span>Completeness</span>
                </div>
            </div>
        </div>
    </div>
    <div id="mag-details-column">
        <h2 id="details-title">MAG Details</h2>
        <span class="info-icon" id="details-panel-info-icon"><i class="bi bi-info-circle"></i></span>
        <div id="details-metrics-text" style="text-align: center; margin-bottom: 10px;"></div>
        <svg id="details-chart"></svg>
        <div id="details-placeholder" style="text-align: center; padding: 20px; display: none;">Select a MAG to view details.</div>
    </div>
  </div>

  <div class="tooltip" style="opacity:0;"></div>

  <!-- Taxonomy Distribution Modal -->
  <div class="overlay" id="taxonomy-overlay">
    <div class="taxonomy-modal">
      <div class="modal-close" id="taxonomy-modal-close">&times;</div>
      <h2 id="taxonomy-modal-title">Taxonomy Distribution</h2>
      <div class="taxonomy-modal-chart">
        <svg id="taxonomy-chart"></svg>
    </div>
  </div>
  </div>

  <script src="mag_visualization.js"></script>
</body>
</html>
